---
title: "Stats 15 Project"
author: "Team 13: Wanyue Dong, Michelle Pang, Liaohan Wang"
date: "10/31/2022"
output: pdf_document
---


# **Section 1 - Introduction**

## **1.1 - Motivating Questions and Scope of Analysis**

As one of the biggest cities in China, Beijing currently houses a population of 21.33 million residents. With the rapid rate of globalization, the movement of people selling and buying their property has risen as well. However, with the help of Lianjia, buyers and sellers are able to view and list properties with ease. In this project, we seek to answer the following motivating question: **what affects the price per square foot of a property?**

## **1.2 - Background on Lianjia**

***Basic Structure:*** Lianjia is a Chinese real-estate company that allows buyers and sellers to view and list properties all over China on the Lianjia website. In our data set, we narrowed down our listings to those that were traded in 2017 in the city of Beijing. This means that any property that was listed or sold in 2017 through Lianjia will be included in this dataset. We found our data set on a website called Kaggle which is a data science company which provides a variety of public data sets. Before cleaning the data, our data set had 318,851 listings and 26 variables.

***How a Seller can Post a Listing:*** To post a listing on Lianjia, the owner or the real estate agent of the property will have to follow the guidelines and steps provided by filling out the necessary information regarding the property such as price of listing, number of bathrooms, square footage of the entire property and more listed below in the explanatory variables. They will also need to provide accompanying photographs of the property.

***How a Buyer can Purchase a Listing:*** To purchase a listing on Lianjia, the buyer can simply just reach out to the contact number or email of the real estate angent provided to arrange a viewing. After viewing the property and possible negotiations, both parties will agree on a price for the transaction and legal paperwork will be organized by the real estate agency to facilitate the payment process and finally legalize the change of ownership of the property.


## **1.3 - Variable Explanation**

### **Explanatory Variables**

1. ***DOM***: (*numerical*) The active days on market. The number of days since the property is posted until it is sold and removed from the website. 
2. ***followers***: (*numerical*) The number of people who follow the transaction by bookmarking the property to revisit later on. This indicates the popularity of a property compared to the other listings. Once the transaction is completed, users can not follow it anymore. It is counted from the property is listed until the transaction is completed.
3. ***livingRoom***: (*numerical*) The number of bedrooms.
4. ***drawingRoom***: (*numerical*) The number of living rooms.
5. ***kitchen***: (*numerical*) The number of kitchens.
6. ***bathRoom***: (*numerical*) The number of bathrooms.
7. ***floor***: (*numerical*) The total number of floors the building has. This usually also refers to the height of the building.
8. ***constructionTime***: (*categorical*) The year the building was constructed.
9. ***renovationCondition***: (*categorical*) The quality of the renovation with 4 being the best and 1 being the worst.
10. ***buildingStructure***: (*categorical*) The material that is used the most to construct the building. More specifically, the main material used to build the exterior of the building. In this case, 1 refers to the material being unknown, 2 refers to the material being a mix of more than 3 distinguishable materials, 3 refers to brick and wood, 4 refers to brick and concrete, 5 refers to steel and 6 refers to steel-concrete composite. 
11. ***ladderRatio***: (*categorical*) The proportion between the number of elevators or ladders that particular floor has to the number of households who live on the same floor. It describes how many ladders a household have on average. In this case, 0.5 means two households share 1 elevator/ladder. The higher the number, the more elevators or ladders a household can use. 
12. ***elevator***: (*categorical*) The presence of an elevator or not. In this case, 1 refers to the presence of an elevator in the building and 0 refers to the absence of an elevator in the building.
13. ***fiveYearsProperty***: (*categorical*) Refers to whether or not the previous owner has owned the property for less than five years. In this case, 1 refers to the property being owned by the previous owner for less than five years and 0 refers to the property being owned by the previous owner for more than five years. In Beijing, if a house/apartment has been owned for 5 years, the tax will be less than owning it for less than five years. 
14. ***subway***: (*categorical*) Based on the knowledge of the seller posting the listing, this variable shows if a subway is located near the property. In this case, 1 refers to the presence of a subway nearby and 0 refers to the absence of a subway nearby. Whether or not a property is near a subway is self reported by the seller.


```{r pressure, echo=FALSE, fig.cap="Beijing District Map", out.width = '50%'}
knitr::include_graphics("beijing_map.jpeg")
```

15. ***district***: (*categorical*) There are 13 main districts in Beijing and each number from 1 to 13 refers to a different district in which the property lies in. In this case, 1 refers to DongCheng, 2 refers to FengTai, 3 refers to YiZhuang (a sub-region of DaXing, we will consider it as DaXing in the following analysis), 4 refers to DaXing, 5 refers to FangShan, 6 refers to ChangPing, 7 refers to ChaoYang, 8 refers to HaiDian, 9 refers to ShiJingShan, 10 refers to XiCheng, 11 refers to TongZhou, 12 refers to MenTouGou, and 13 refers to ShunYi.

As shown in the map above, there are a total of 16 districts in Beijing, but we mainly focuses on the listed 12 districts which are shown on the map as yellow, red, and purple. Green districts are not included in this Lianjia dataset. Yellow and red parts are considered the core districts. In other words, "the city". They contains the main functions of Beijing in political, cultural and economic ways. The yellow parts, DongCheng and XiCheng contain the most history of the city. They have a relative small area but most ancient buildings preserved. Thus, there are actually not that much area could be used for residency nor new structures. Among these red parts, ChaoYang and HaiDian are a bit special. ChaoYang is the largest among the core districts. It has the majority of foreign embassies and it is also the business center. HaiDian is famous for education. It contains the most education institutions. Purple parts are considered suburb areas where airports are located. Green parts are excluded from our data because these are relative rural that are mostly made up of mountains, Great Walls, manors for travelers, etc.

### **Response Variable**
1. ***price***: (*integer*) The price per square foot of the property (price = totalPrice / square). To ensure that the price is a fair comparison across all the properties listed, we decided to compare the price per square foot of all properties instead of totalPrice. Since some properties may be bigger than others, comparing price per square foot provides us with a better understanding of how valuable a property is.



# Section 2: Data Cleaning
```{r, message=FALSE, warning=FALSE}
# loading libraries
library(lubridate)
library(dplyr)
library(VIM)
library(stringr)
library(ggplot2)
library(naniar)
library(waffle)
```

```{r}
# the following code is used to import dataset that includes Chinese character
data <- read.csv("new.csv", fileEncoding = "GBK", encoding = "GBK")
```


## 2.1 Cleaning Trade Time Variable
The `tradeTime` variable is in the format of y-m-d, we wanted to look at year, month, and day separately. Therefore, we created new variables `year`, `month`, `day` based on `tradeTime`. \newline
Since the current data has 318851 rows, we decided to use part of the data where the trade time was in 2017.

```{r, message=FALSE, warning=FALSE}
data2017 <- data %>% 
  mutate(year = year(tradeTime), month = month.name[month(tradeTime)], day = day(tradeTime)) %>%
  filter(year == 2017)
```


## 2.2 Cleaning Floor Variable 

The `floor` variable two piece of information. The first part, which is in Chinese character, informs the floor range of the apartment/house. The second part, which is a number, tells us the total number of floors the building has. Therefore, we need to separate these two information into two new variables (` totalFloor` and `floorRange`) to better analyze them. At the same time, we converted Chinese characters into English. 

```{r, echo=FALSE}
data2017 <- data2017 %>% 
  mutate(totalFloor = as.numeric(str_extract(floor, "(\\d)+")), 
         floorRange = case_when(str_detect(floor, "顶") ~ "top", 
                                str_detect(floor, "高") ~ "high", 
                                str_detect(floor, "中") ~ "medium",
                                str_detect(floor, "低") ~ "low",
                                str_detect(floor, "底") ~ "bottom"))

```

## 2.3 Cleaning variable format

Some variables such as living room and bedroom  should be numerical variable, while other variables such as subway and elevator should be categorical variables. We also recoded the district variable into district names, which will be easier to see for later analysis. Moreover, the living room in this dataset should be bedroom and drawing room in this dataset should be living room. Finally, we recoded some categorical variables such as subway and elevator to have text in the values to see them clearly. 

```{r, warning=FALSE, message=FALSE}

data2017 <- data2017 %>% 
  rename(livingRoom = drawingRoom, bedRoom = livingRoom) %>%
  mutate(constructionTime = as.numeric(constructionTime), 
         livingRoom = as.numeric(livingRoom),
         bedRoom = as.numeric(bedRoom),
         bathRoom = as.numeric(bathRoom),
         kitchen = as.numeric(kitchen),
         subway = as.factor(subway),
         elevator = as.factor(elevator),
         fiveYearsProperty = as.factor(fiveYearsProperty),
         district = recode(district, "1" = "DongCheng",
                           "2" = "FengTai", "3" = "DaXing", "4" = "DaXing", 
                           "5" = "FangShan", "6" = "ChangPing", "7" = "ChaoYang",
                           "8" = "HaiDian", "9" = "ShiJingShan", "10" = "XiCheng", 
                           "11" = "TongZhou", "12" = "MenTouGou", "13" = "ShunYi"),
         subway = recode(subway, "0" = "not_near_subway", "1" = "near_subway"),
         elevator = recode(elevator, "0" = "no", "1" = "yes"),
         fiveYearsProperty = recode(fiveYearsProperty, "0" = "no", "1" = "yes"),
         renovationCondition = recode(renovationCondition, "1" = "other", "2" = "rough", 
                                      "3" = "simplicity", "4" = "hardcover"),
         buildingStructure = recode(buildingStructure, "1" = "other", "2" = "mixed", 
                                    "3" = "brick&wood", "4" = "brick&concrete", 
                                    "5" = "steel-concrete"))
```




## 2.4 Missing Values

```{r, message=FALSE, warning=FALSE}
table(is.na(data2017))
na_plot <- aggr(data2017, col=c('skyblue','red'), numbers=TRUE, sortVars=TRUE, 
                labels=names(data2017), cex.axis=.4, gap=3, ylab=c("Missing data","Pattern"))
```

Our data had 1303 missing values. All missing values are in variables construction time, building type, community average, and floor range. The above graph shows the proportion of missing values in each variable with the highest being 0.018 for construction time. \newline
We decided to remove all missing values for two reasons. First, 1303 missing values is a relatively small amount of data compared to 43217 observations we have. Second, we did not plan to use the variable buildingType and community average, which had a large portion of missing values. 

```{r}
data2017 <- na.omit(data2017)
```

Now we have 42710 observations.

## 2.5 Remove unnecessary variables

The final step of data cleaning is removing variables that we do not plan to use. 
```{r}
data2017 <- data2017 %>%
  select(-c(url, Lng, Lat, Cid, tradeTime, floor, buildingType, communityAverage, year))
```




# Section 3: Exploratory Analysis

## 3.1 Distribution of variables and outliers

### 3.1.1 Month
```{r}
ggplot(data2017, aes(x = month)) + 
  geom_bar(fill = "light blue") + 
  scale_x_discrete(limits = month.name)
```

The first three months of year 2017 had the most trading of houses, with March being the highest number of trading, more than 8000 tradings. Apirl, May, and June each only had less than 1/4 of the number of trading compared to March. The amount of transactions for the rest of the year remained below 4000. One possible explanation for this trend is that Chinese people like to buy houses in the beginning of the year as a way of starting a fresh year. 


### 3.1.2 Day
```{r}
ggplot(data2017, aes(x = day)) + 
  geom_histogram(fill = "light blue", color = "black", bins = 31)
quantile(data2017$day)
```
Number of transactions of a day is uniform. There isn't a unique day of the month that people liked to buy houses, but people relatively like to buy houses in the middle of the month. Few trades happened in the beginning of the month. Approximately 25% of the houses are sold on and before 10th. 50% of the houses are sold on or before 17th. 25% of the houses are sold on or after 24th. 


### 3.1.3 Total Floor
```{r}
ggplot(data2017, aes(x = totalFloor)) + geom_histogram(color = "black", fill = "blue") 
quantile(data2017$totalFloor, c(0, .025, .25, .5, .75, .975, 1))

data2017 %>% arrange(desc(totalFloor)) %>% select(id, totalFloor, floorRange) %>% head()
data2017 <- data2017 %>%
  filter(totalFloor < 60)
```
The distribution of total floor is unimodel and skewed to the right. The median number of floors is 6. 75% of the buildings less than or equal to 6 floors. Only 2.5% of the buildings had more than 18 floors. Some high numbers could be an error in data recording. The url for the apartment located in a building with 63 floors is invalid; however, we checked the apartment located in the building with 57 floors using url and, surprisingly, the building does exist and is called Yu Jin Tai. Therefore, we only removed the trade with total floor of 63. 



### 3.1.4 Floor Range
```{r}
data2017$floorRange <- factor(data2017$floorRange,
                  levels = c("bottom", "low", "medium", "high", "top"))
summary_table <- data2017 %>% group_by(floorRange) %>%
  summarise(total = n()) %>%
  mutate(percent = round(100 * total / sum(total)))
counts <- summary_table$percent
names(counts) <- summary_table$floorRange
print(counts)
waffle(counts)
```
Apartments located in the middle of a building were traded the most in 2017. All the other floor range had roughly the same percentage. 



### 3.1.5 DOM
The distribution of number of days on market is unimodal and heavily skewed to the right. The mean number of days on market is around 51 and the median is 31 days. The difference between mean and median shows that there are more houses with relative longer days on market. Approximately 2.5% of values are below 2. Approximately 2.5% of values are above 196. The longest day on market is 721. Whereas there are total of 474 houses have less or equal to 1 day on market until sold.

```{r}
ggplot(data2017, aes(x=DOM))+
  geom_histogram(fill='lightblue', color='black') +
  xlab("DOM")+ylab("Count")+ggtitle("Active Days on Market Histogram")

mean(data2017$DOM)
quantile(data2017$DOM, c(0, 0.025, 0.25, 0.5, 0.75, 0.975, 1))

data2017 %>%
  filter(DOM<=1) %>%
  nrow()  # number of houses have less than 1 day on market
```

### 3.1.6 followers

The distribution of number of followers is unimodal and heavily skews right. The mean and median number of followers are all around 49 people. Approximately 2.5% of values are below or equal to 0. However, the highest 2.5% are between 228 and 1045, which suggests that there are a few significantly popular houses the great amounts of followers. There are 2021 houses with 0 follower and also a total of 5 houses with more than 1000 followers. Among houses with more than 1000 followers, 1 house has significant low total price compare with others. However, it also has relative small squares and located in the suburb, which makes this reasonable. 

```{r}
ggplot(data2017, aes(x=followers))+
  geom_histogram(fill='lightblue', color='black') +
  xlab("followers")+ylab("Count")+ggtitle("followers Histogram")

mean(data2017$followers)
quantile(data2017$followers, c(0, 0.025, 0.25, 0.5, 0.75, 0.975, 1))
table(data2017$followers==0) # 2021 houses with 0 follower

data2017 %>% filter(followers>1000)
```


### 3.1.7 totalPrice

The distribution of total price is diamond-shaped, unimodal, and skews right. The average total price is 456x10,000 yuan (around 650~760k USD depend on inflation) and the median is 418x10,000 yuan (around 600~640k USD). 
Approximately 2.5% of values are below 220x10,000 yuan. Approximately  2.5% of values are above 1250x10,000 yuan. 

```{r}
ggplot(data2017, aes(x=totalPrice))+
  geom_histogram(fill='lightblue', color='black') +
  xlab("totalPrice")+ylab("Count")+ggtitle("Total price (in 10,000yuan) Histogram")

mean(data2017$totalPrice)
quantile(data2017$totalPrice, c(0, 0.025, 0.25, 0.5, 0.75, 0.975, 1))
```


### 3.1.8 price

The distribution for price is Diamond-shaped, unimodal, and skewed right. The average price per square meter is around 67,430 yuan and median is 62,670 yuan, which are close. Approximately 2.5% of values are above 127,359 yuan. Approximately 2.5% of values are below 33,035 yuan. The house that has the lowest value has 136 yuan per square meter, which is about 20 dollars per square meter. Such low price doesn't make sense in any part of Beijing. Therefore, we decided to remove this outlier. 

```{r}
ggplot(data2017, aes(x=price))+
  geom_histogram(fill='lightblue', color='black') +
  xlab("price")+ylab("Count")+ggtitle("Average price per square meter (in yuan) Histogram")

mean(data2017$price)
quantile(data2017$price, c(0, 0.025, 0.25, 0.5, 0.75, 0.975, 1))
```


### 3.1.9 square

The graph of number of squares is diamond-shaped, unimodal, and skews right. The mean is around 73 square meters. The median is 63.85 square meters. Approximately 2.5% of values are below 38.6 square meters. Approximately 2.5% of values are above 150 square meters. 

```{r}
ggplot(data2017, aes(x=square))+
  geom_histogram(fill='lightblue', color='black') +
  xlab("square")+ylab("Count")+ggtitle("square of the House Histogram") 

mean(data2017$square)
quantile(data2017$square, c(0, 0.025, 0.25, 0.5, 0.75, 0.975, 1))
```
A house with more 1745.5 square meter seems very unreasonable, so we decided houses that are less than 1000 square meters are plausible. 
```{r}
data2017 <- data2017 %>% 
  filter(square < 1000)
```

### 3.1.10 bedRoom

One thing need to be noticed is that in this dataset, the variable 'livingRoom' could be understand as 'bedroom' in the US. Thus, we decided to change the variable name from 'livingRoom' to 'bedRoom'. 
The graph of number of bedrooms is unimodal and skews right. Most of the houses have 2 bedrooms, and the mean and median number of bedrooms is also 2. Approximately 25% of values are below or equal to 1. Approximately  2.5% of values are above 3.

```{r}
ggplot(data2017, aes(x=bedRoom))+
  geom_bar(fill='lightblue', color='black') + 
  xlab("bedRoom")+ylab("Count")+ggtitle("Number of bedroom Barplot")

mean(data2017$bedRoom)
quantile(data2017$bedRoom, c(0, 0.025, 0.25, 0.5, 0.75, 0.975, 1))
```

There is one house has 0 bedroom but sold in 145,612 yuan per square meter which almost reached the highest price among all observations (150,000 yuan). It is located in XiCheng. According to Lianjia, it belongs to "RongFeng 2008" community. After a research on the community, we found out that this is the average price per square meter for this community. An investigation conducted by The Beijing News indicates that "RongFeng 2008" has a relative 10,000 yuan higher price per square meter compared with other communities in that area due to management and good school district. But since the properties in this community have very small areas, the total price is still acceptable for most people who wanted to move to XiCheng. 
Also, this house is labeled 0 bedroom but 1 livingroom, which might be a mistake. This house could be considered as a studio with total of 1 room. Thus, we decide to change it from "1 livingroom, 0 bedroom" to "1 bedroom, 0 livingroom".
So this house is not an outlier.
(https://www.sohu.com/a/479132582_114988)

```{r}
data %>%
  filter(id=="101101275312")
```

### 3.1.11 livingRoom

The distribution of number of livling rooms is unimodal and skews right. The mean and median number of living room is 1. Approximately 2.5% of values are above 2. The number of living rooms for all houses sold in 2017 is between 0 to 3. 87% have 1 livingroom. Houses with 0 living room is the second greatest choice, and it is reasonable for a house to have no living room, especially in the city.

```{r}
ggplot(data2017, aes(x=livingRoom))+
  geom_bar(fill='lightblue', color='black') + # use geom_bar() instead of geom_histogram()
  xlab("livingRoom")+ylab("Count")+ggtitle("Number of Living Rooms Histogram")

table(data2017$livingRoom)/length(data2017$livingRoom)

mean(data2017$livingRoom)
quantile(data2017$livingRoom, c(0,0.025,0.25,0.5,0.75,0.975,1))
```


### 3.1.12 district (Categorical)

ChaoYang as one of the core districts (yellow and red) has the most houses sold in 2017. 
XiCheng and Haidian have similar houses sold where XiCheng has much smaller areas than Haidian.
FangShan and MenTouGou have significant small amounts of houses transactions where these 2 are suburb districts (purple) that have relative large areas shown on the map. In contrast, as another suburb district, ChangPing has the second greatest amounts of houses sold in 2017. 

```{r}
ggplot(data2017, aes(x=district))+
  geom_bar(fill='lightblue', color='black') +
  xlab("district")+ylab("Count")+theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))+
  ggtitle("District the House located Histogram") 

table(data2017$district)/length(data2017$district) # percentage of houses sold in each district
```

#### Percentage of houses sold in core districts or suburb
Both suburb and core districts contain 6 districts. Though suburb have much larger areas shown on the map, 34.4% of houses sold are located in the suburb where core districts have houses sold that made up 65.6% of the market.

```{r}
# !!! use graph here
core_district <- data2017 %>%
  filter(district %in% c("XiCheng" , "DongCheng" , "ChaoYang" , "HaiDian" , "ShiJingShan" , "FengTai")) %>% nrow()
core_district/length(data2017$district)
suburb <- data2017 %>%
  filter(district %in% c("DaXing", "ChangPing", "FangShan", "MenTouGou", "ShunYi", "TongZhou")) %>% nrow()
suburb/length(data2017$district)
```


### 3.1.13 kitchen

The distribution for the number of kitchens shows that most listings have only one kitchen in their property.

``` {r}
ggplot(data2017, aes(x = kitchen)) +
  geom_bar(fill = "lightblue") +
  ggtitle("Kitchen Summary") + xlab("Number of Kitchens") + ylab("Count")
```


```{r}
data2017 %>% 
  filter(kitchen > 2) 
```

There are two houses with more than 2 kitchens, which seem odd. Taking a closer look, both of these houses had less than 300 square meters, which is impossible to have 3 kitchens in fairly medium house size. Therefore, we removed these two outliers.

```{r}
data2017 <- data2017 %>%
  filter(kitchen < 3)
```


### 3.1.14 bathroom

The distribution for the number of bathrooms shows that most listings have only one bathroom in their property. This distribution skews heavily to the right and we can see that there is a sharp decrease in the number of listings with two, three or four bathrooms.

``` {r}
ggplot(data2017, aes(x = bathRoom)) +
  geom_bar(fill = "lightblue") +
  ggtitle("Bathroom Summary") + xlab("Number of Bathrooms") + ylab("Count")
```

### 3.1.15 construction time

```{r}
table(data2017$constructionTime)
```

``` {r}
median(data2017$constructionTime)
mean(data2017$constructionTime)
```

The year of construction of the listings that were transacted in 2017 ranges from the year 1950 to the year 2016. Out of all the included listings, most of the properties were built in the year 2004 accumulating a total of 2525 properties.

The distribution skews to the left as the median number of listings were constructed in the year 2002 and mean number of listings were constructed in the year 1999 where both lie to the left of the mode of the listings that were constructed in the year 2004.

There is also a sharp increase in the number of listings being constructed leading up to the year 1980 but a sharp drop in the number of listings being constructed after the year 2004.

``` {r}
ggplot(data2017, aes(x = constructionTime)) +
  geom_histogram(fill = "lightblue") +
  ggtitle("Time of Construction Summary") + xlab("Time of Construction") + ylab("Count")
```

### 3.1.16 renovation condition

The distribution for the condition of renovation shows that most listings have the highest rating of simplicity in terms of the condition of renovation for their listing.

``` {r}
ggplot(data2017, aes(x = renovationCondition)) +
  geom_bar(fill = "lightblue") +
  ggtitle("Condition of Renovation Summary") + xlab("Condition of Renovation") + ylab("Count")
```

### 3.1.17 building structure

The distribution for the building structure shows that most listings are made of steel-concrete composite. 

``` {r}
ggplot(data2017, aes(x = buildingStructure)) +
  geom_bar(fill = "lightblue") +
  ggtitle("Structure of Building Summary") + xlab("Structure of Building") + ylab("Count")
```

### 3.1.18 ladder ratio

The maximum value for ladderRatio is 10009400, which seems like a typo, so we decided to remove this observation. 

``` {r}
data2017 <- data2017 %>% 
  filter(ladderRatio < 5)
```

```{r}
table(data2017$ladderRatio)
```

``` {r}
median(data2017$ladderRatio)
mean(data2017$ladderRatio)
```

The distribution for the ladder ratio shows that most listings have 2 residents to one elevator per floor. This distribution skews heavily to the left.

``` {r}
ggplot(data2017, aes(x = ladderRatio)) +
  geom_histogram(fill = "lightblue", width = 0.05) +
  ggtitle("Ladder Ratio Summary") + xlab("Ladder Ratio") + ylab("Count")
```

### 3.1.19 elevator

The distribution for the presence of an elevator shows that it is more common for listings to have at lease one elevator in the building compared to none at all.

``` {r}
ggplot(data2017, aes(x = elevator)) +
  geom_bar(fill = "lightblue") +
  ggtitle("Availability of Elevator") +xlab("Elevator") +ylab("Count")
```

### 3.1.20 five years property

The distribution shows that most sellers stay in their property for less than five years.

``` {r}
ggplot(data2017, aes(x = fiveYearsProperty)) +
  geom_bar(fill = "lightblue") +
  ggtitle("Five Years Property Summary") + xlab("Five Years Property") + ylab("Count")
```

### 3.1.21 subway

The distribution for the presence of any nearby subways shows that it is more common for listings to have at lease one subway nearby the building compared to none at all.

``` {r}
ggplot(data2017, aes(x = subway)) +
  geom_bar(fill = "lightblue") +
  ggtitle("Subway Summary") + xlab("Availability of Nearby Subways") + ylab("Count")
```



## 3.2 Potential Relationships between Variables

### 3.2.1 DOM vs. followers

*Do houses sold fast have many followers?*
Among these 188 houses that were sold within 1 day, 140 have no follower and the maximum number of followers is 25, which is not a significant number. Our guessing is that the owner and buyer might have already planned about this deal privately and they just list the property on an official third-party website like LianJia to make the transaction secure and supervised.
```{r}
table(data2017$DOM<=1) # houses are 0 or 1 Days on market

follower1DOM <- data2017 %>%
  filter(DOM<=1) %>%
  count(followers) # Do houses sold fast have many followers?
ggplot(follower1DOM, aes(x=followers,y=n))+
  geom_col(fill="lightblue")
```
Let's take a closer look at the houses sold within 200 days on market. There seems to be a slightly increase on the number of followers as it stays more days on market. But it is not as what we expected that the more days a property listed on market the more followers it has.
```{r}
ggplot(data2017, aes(x=DOM,y=followers))+ # overall number of followers vs. DOM
  geom_point(alpha=.1)+
  geom_smooth()+
  xlim(0,200)
```



### 3.2.2 price vs. district

There is no doubt that the most essential factor that affects the price is the location of the property. XiCheng has the highest price which is above 105,000 yuan and DongCheng is the next, they are the most center districts of the city (Yellow). And then followed by other core districts (Red) HaiDian, ChaoYang, FengTai, and ShiJingShan. TongZhou has the highest price among other suburb districts, and then DaXing, ChangPing, MenTouGou, and ShunYi. Lastly, FangShan has the lowest price which is around 30,000 yuan. The highest price is more than 3 times higher than the lowest price. And the distribution of price is strictly following the location of the district that center districts have the highest prices, and then core districts, and lastly the suburb districts.

```{r}
price_district <- data2017 %>%
  group_by(district) %>%
  summarise(meanPriceDistrict=mean(price))
ggplot(price_district, aes(x=reorder(district, meanPriceDistrict), y=meanPriceDistrict))+
  geom_col(fill="lightblue") +
  ggtitle("Mean Price vs. District") +ylab("price")+xlab("")+
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))
```

XiCheng still has the highest median price that is above 100,000 yuan and the second one is DongCheng which is around 100,000 yuan. FangShan still got the lowest median price which is around 30,000 yuan. The distribution of median prices is the same as the distribution of mean price. It seems like both HaiDian and ChaoYang have big range of house price. But HaiDian has overall higher prices than ChaoYang.

```{r}
ggplot(data2017, aes(x=district,y=price))+
  geom_boxplot()+
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))
```


### 3.2.4 construction time vs. district

From the distribution of time of construction by district, we see that for the district of ChaoYang, there is a gradual increase in the number of listings being constructed since 1950 and then a sharp decrease after it reached its peak. For the district of ChangPing, there is a sharper increase in the number of listings being constructed since 1950 compared to ChaoYang but a more gradual decrease after it reached its peak. For the other districts, the number of listings being constructed changes less drastically compared to ChaoYang and ChangPing.

``` {r}
ggplot(data2017, aes(x = constructionTime)) +
  geom_bar(fill = "lightblue") +
  ggtitle("Distribution of Time of Construction by District") + xlab("Time of Construction") + ylab("Count") +
  facet_wrap(~ district)
```

### 3.2.5 renovationCondition vs. district

From the distribution of renovation condition by district, we see that ChaoYang has the highest number of listings with the *simplicity* rating and ChangPing has the highest number of listings with the *hardcover* rating.

``` {r}
ggplot(data2017, aes(x = renovationCondition)) +
  geom_bar(fill = "lightblue") +
  ggtitle("Distribution of Renovation Condition by District") + xlab("Renovation Condition") + ylab("Count") +
  facet_wrap(~ district) +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))
```


### 3.2.6 district vs. square

As indicated under the 'square' variable, the top 2.5% of houses sold have area over 149.97 square meters. Let's define them as "large houses". The bottom 2.5% of houses sold have less than 38.63 square meters. Let's define them as "small houses". 

*Districts with most large and small houses*
ChangPing has the significant highest amounts of large houses sold and ChaoYang has the significant highest amounts of small houses sold. The distribution of large and small houses in ShunYi and Haidian are even.
```{r}
large <- data2017 %>%
  filter(square>=149.97) %>% # number of large houses in each district 
  count(district)
small <- data2017 %>%
  filter(square<=38.63) %>% # number of small houses in each district
  count(district) 
full1 <- small %>%
  full_join(large,by="district",suffix = c("_small","_large"))
pivot <- full1 %>%
  pivot_longer(col=c("n_large","n_small"))

ggplot(pivot,aes(x=district,y=value,fill=name))+
  geom_col()+
  facet_wrap(~name)+
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))
```

*Proportion of large and small houses within each district*
The majority of houses for all districts are middle sized. ChangPing has the highest proportion of large houses followed by ShunYi which has relative even distributions of small and large houses. These 2 are suburb districts with large areas on the map. HaiDian is another district that has relative evenly distributed large and small houses. All core districts all have more small houses than large. FangShan has no small house and only 1 large house, but overall it has the least amounts of house transactions. 
```{r}
middle <- data2017 %>%
  filter(square>=38.63 & square<=149.97) %>%
  count(district)
full2 <- full1 %>%
  full_join(middle,by="district")
pivot2 <- full2 %>%
  pivot_longer(col=c("n_large","n_small","n")) %>%
  replace(is.na(.), 0)
ggplot(pivot2,aes(x=district,y=value,fill=name))+
  geom_col(position="fill")+ # stacked proportion barplot
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))
```

### 3.2.6 elevator vs. building structure

From the distribution of presence of elevator by building structure, we see that the greatest number of listings with the availability of an elevator are those that have a building structure of steel-concrete composite. For the greatest number of listings with the absence of an elevator, those would have a building structure of a mix of more than 3 distinguishable materials.

``` {r}
ggplot(data2017, aes(x = elevator, fill = elevator)) +
  geom_bar(colour = "black") +
  ggtitle("Distribution of Elevator by Building Structure") +
  xlab("Building Structure") + ylab("Count") +
  facet_wrap(~ buildingStructure)
```

### 3.2.7 five years property vs. district

From the distribution of five years property by district, we see that the district of ChaoYang has the highest number of previous owners who stayed in their property for more than 5 years followed by ChangPing. On the other hand, ChaoYang also has the highest number of previous owners who stayed in their property for less than 5 years followed by ChangPing. This is because ChaoYang is the largest district compared to the others and thus in terms of the total number of people staying more than or less than 5 years in that district will be the highest overall.

``` {r}
ggplot(data2017, aes(x = fiveYearsProperty, fill = fiveYearsProperty)) +
  geom_bar(colour = "black") +
  ggtitle("Distribution of Five Years Property by District") +
  xlab("Five Years Property") +ylab("Count") +
  facet_wrap(~ district)
```


### 3.2.8 price vs. subway

Subway is one of the most important transportation in Beijing. Near subway or not also shows if the property is located in a busy area.

```{r}
meanSubway <- data2017 %>%
  group_by(subway) %>%
  summarise(meanSubwayPrice=mean(price))
ggplot(meanSubway, aes(x=subway, y=meanSubwayPrice))+
  geom_col(fill="lightblue")
```
*Is this affected by district?*
Consider of the fact that core districts might have more houses near subway whereas other districts might have less, the price might be affected by the factor of district. Let's see how a house is near subway or not will affect the price within each district. The conclusion is still that for most districts mean price is higher if the house is near subway. FangShan is an exception that houses near subway actually have lower mean price. Another thing need to be noticed is that MenTouGou does not have houses near subway. 

```{r}
meanSubwayDistrict <- data2017 %>%
  group_by(subway,district) %>%
  summarise(meanSubwayDistrictPrice=mean(price))
ggplot(meanSubwayDistrict, aes(x=subway, y=meanSubwayDistrictPrice))+
  geom_col(fill="lightblue")+
  facet_wrap(~district)
```




### 3.2.9 Price vs Ladder Ratio and Floor Range
```{r}
ggplot(data2017, aes(x = totalFloor, y = price, color = floorRange)) + 
  geom_point()+
  labs(x = "total number of floors", title = "Price vs Total Floor and Floor Range")
```

The floor range did not make a huge influence on the price of the house. However, the price drops significantly to 50,000 Yuan or below if the total floor is above 30, with one exception, which is the property that has 63 floors. In general, the price per square meter is lower for properties located in buildings higher than 30 floors. 

### 3.2.10 Price vs Followers
We would expect the price to be lower if there were many followers on a property because people like to keep an eye on things that are cheaper. 

```{r}
ggplot(data2017, aes(x=followers, y=price))+ geom_point() + geom_smooth() +
  labs(title = "Price vs Followers")
```

The above graph does show the negative trend between price and followers. As followers increase, the price of the perperty is lower, although this trend does not apply to houses with very few followers because many properties ranging from low price to high price had few followers. 


### 3.2.11 district vs. totalPrice

Haidian has the top 2 highest total prices. FangShan has the smallest range of total prices. From the boxplot, we can see that DongCheng, HaiDian, and XiCheng are the 3 districts that have relative high total prices.

```{r}
ggplot(data2017, aes(x=district,y=totalPrice))+
  geom_boxplot()+
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))
```



*five year property issue*

The first and second highest total prices houses sold in 2017 are all located in HaiDian. Surprisingly, these 2 have exactly same features except one is over 5 years and one is not. The one satisfies five years property feature was sold around 20% cheaper than the one doesn't. These 2 houses are indeed from the same community and the deal time is only 1 month difference. 

```{r}
data2017 %>%
  slice_max(totalPrice,n=2)

(3087.2-2457.2)/3087.2
```



### 3.2.12 price vs. month (Categorical)

Overall, there is no huge differences on mean price per square on each month. The distribution skews right and it is bimodal that has peaks on March and July. As shown under the month variable section that March has the most transactions, the price is also at the peak on March. February and April have relative higher price. After March, the price starts to decrease until July it reaches the second peak. And then the price keeps decreasing and reaches the bottom on December.

```{r}
monthPrice <- data2017 %>% 
  group_by(month) %>%
  summarise(meanPrice=mean(price))
ggplot(monthPrice,aes(x=month,y=meanPrice))+
  geom_col(fill = "lightblue")+
  scale_x_discrete(limits = month.name)
```


### 3.2.13 price vs. floorRange

There is a slight decreasing trend. The higher the property is located, the lower the average price is. Medium and bottom floor ranges seem to have relative higher price whereas top floor range has the lowest.

```{r}
data2017 %>% 
  group_by(floorRange) %>%
  summarise(meanPrice2=mean(price))%>%
  ggplot(aes(x=floorRange, y=meanPrice2))+
  geom_col(fill="lightblue") 
```

```{r}
bottom_price <- data2017 %>%
  filter(floorRange== "bottom") %>%
  select(price) %>% pull()
top_price <- data2017 %>%
  filter(floorRange== "top") %>%
  select(price) %>% pull()
t.test(bottom_price, top_price)
```

The result of t-test is consistent with the graph, showing that the average price of bottom properties is significantly different from average price of top houses. 



### 3.2.14 Price vs subway vs district
```{r, warning=FALSE, message=FALSE}
data2017 %>%
  group_by(district, subway) %>%
  summarise(average_price = mean(price)) %>%
  ggplot(aes(x = district, y = average_price, fill = subway)) +
  geom_col(stat = "identity", position = position_dodge(), alpha = 0.75)  +
  labs(x = "Districts", y = "price", title = "Price vs District vs Subway") +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5))
```


### 3.2.15 Price vs. Renovation vs. district

For most districts, rough condition has the lowest mean price, except for ChaoYang, HaiDian, and TongZhou. But unexpectedly, hardcover condition houses does not always have the highest price, this might also due to other factors of the property such as subway, etc. 

```{r}
meanRenov <- data2017 %>%
  group_by(renovationCondition, district) %>%
  summarise(meanRenovPrice=mean(price))
ggplot(meanRenov, aes(x=district, y=meanRenovPrice, fill=renovationCondition))+
  geom_col(stat = "identity", position = position_dodge(), alpha = 0.75)+
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5))
```


### 3.2.16 price vs. kitchen

Houses with more kitchens actually have lower mean prices. But this might due to the reason that district played a key factor on the price. Let's compare how the number of kitchens affect price within each district.

```{r}
meanKitchen <- data2017 %>%
  group_by(kitchen) %>%
  summarise(meanKitchenPrice=mean(price))
ggplot(meanKitchen, aes(x=kitchen, y=meanKitchenPrice))+
  geom_col(fill="lightblue")
```

In HaiDian, different numbers of kitchens seem to have significant effects on the price and more kitchens indicates lower price. Just like what we have seen under the district variable that HaiDian has the largest range of house price. Other suburb districts such as ChangPing, FangShan, ShunYi, and TongZhou also have the same trend. This could due to the reason that less kitchen indicates the house is located in the center area of this specific district and thus has a higher price compared with other houses. 

```{r}
meanKitchenDistrict <- data2017 %>%
  group_by(kitchen,district) %>%
  summarise(meanKitchenDistrictPrice=mean(price))
ggplot(meanKitchenDistrict, aes(x=kitchen, y=meanKitchenDistrictPrice))+
  facet_wrap(~district)+
  geom_col(fill="lightblue")
```

### 3.2.17 price vs. bedRoom

The more bedrooms also indicate the lower mean house price is. However, simply look at the mean price for all houses is not enough because district plays the key role. Let's compare how the number of bedrooms affect price within each district.

```{r}
meanBed <- data2017 %>%
  group_by(bedRoom) %>%
  summarise(meanBedPrice=mean(price))
ggplot(meanBed, aes(x=bedRoom, y=meanBedPrice))+
  geom_col(fill="lightblue")
```

There is also a trend observed for some districts that the more bedrooms the lower price is. However, most graphs are actually bimodal. For example, in XiCheng, houses sold with 0 or 5 bedrooms are the two peaks of price. The most obivious example is FengTai that houses sold with 4 bedrooms have the significant high price caompared with others in that district. 
```{r}
meanBedDistrict <- data2017 %>%
  group_by(bedRoom,district) %>%
  summarise(meanBedDistrictPrice=mean(price))
ggplot(meanBedDistrict, aes(x=bedRoom, y=meanBedDistrictPrice))+
  facet_wrap(~district)+
  geom_col(fill="lightblue")
```

### 3.2.18 five years property vs. district vs. price

By using side by side bar graphs, we can see the relationship between the price of the listings compared to their corresponding districts and whether the owners have stayed in the listing for more than five years or less than five years. From the distribution, we can see that the most expensive listings are from the districts DongCheng, HaiDian and XiCheng and are usually stayed in for less than five years. Looking at the other end of the spectrum, we can see that the lower priced listings are found in districts FangShan and MenTouGou and are more likely to be stayed in for more than five years. This could be due to the affordability of the properties in the district. 

``` {r}
ggplot(data2017, aes(x = district, y = price, fill = fiveYearsProperty)) +
  geom_bar(stat = "identity", position = position_dodge(), alpha = 0.75) +
  ggtitle("Distribution of Price by District and Five Years Property") +
  labs(x = "District", y = "Price") +
  theme(plot.title = element_text(hjust = 0.5, face="bold"), 
        axis.title.x = element_text(face="bold", size = 12),
        axis.title.y = element_text(face="bold", size = 12),
        legend.title = element_text(face="bold", size = 10)) +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))

```


### 3.2.19 district vs elevator vs price

``` {r}
ggplot(data2017, aes(x = district, y = price, fill = elevator)) +
  geom_bar(stat = "identity", position = position_dodge(), alpha = 0.75) +
  ggtitle("Distribution of Price by District and Presence of Elevator") +
  labs(x = "District", y = "Price") +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"), 
        axis.title.x = element_text(face="bold", size = 12),
        axis.title.y = element_text(face="bold", size = 12),
        legend.title = element_text(face="bold", size = 10)) +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))
```

### 3.2.20 construction time vs elevator vs price

Looking at the distribution between these three relationships, we can see that as the year of construction increases, the availability of an elevator in the building becomes increasingly available and the price of the listing gradually increases as well. However, after the year 2012, there is a sharp decrease in price until 2015. 

``` {r}
ggplot(data2017, aes(x = constructionTime, y = price, fill = elevator)) +
  geom_histogram(stat = "identity", position = position_dodge(), alpha = 0.75) +
  ggtitle("Distribution of Price by Construction Time and Presence of Elevator") +
  labs(x = "Time of Construction", y = "Price") +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"), 
        axis.title.x = element_text(face="bold", size = 12),
        axis.title.y = element_text(face="bold", size = 12),
        legend.title = element_text(face="bold", size = 10))
```


### 3.2.21 price vs construction time

From the distribution between price and construction time, we can see that there is a gradual increase in price leading up to 1980. From the year 1980 to 2014, the price fluctuates up and down but ends up with a sharp decrease in price from 2014 onewards.

```{r}
ggplot(data2017, aes(x = constructionTime, y = price)) +
  geom_point() +
  labs(x = "Time of Construction", y = "Price", title = "Distribution of Price by Construction Time") +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))
```


### 3.2.22 price vs. living room

The graph shows that the more living rooms are the lower price is. Houses sold with no living room have the highest mean price. As shown under the living room variable section, most houses have 1 living room. The price of houses with 1 living room is slightly lower, however, as the number of living rooms increase to 2, the mean price drops for nearly 20,000 yuan. Let's compare how the nu ber of living rooms affect house price within each district.

```{r}
meanLiving <- data2017 %>%
  group_by(livingRoom) %>%
  summarise(meanLivingPrice=mean(price))
ggplot(meanLiving, aes(x=livingRoom, y=meanLivingPrice))+
  geom_col(fill="lightblue")
```

For most district, houses with 0 or 1 living room still have relative higher price. Except for ChaoYang that houses with 4 living rooms have the highest mean price.
```{r}
meanLivingDistrict <- data2017 %>%
  group_by(district,livingRoom) %>%
  summarise(meanLivingDistrictPrice=mean(price))
ggplot(meanLivingDistrict, aes(x=livingRoom, y=meanLivingDistrictPrice))+
  facet_wrap(~district)+
  geom_col(fill="lightblue")
```


### 3.2.23 price vs. bathrooms

```{r}
table(data2017$bathRoom)
```

Despite the fact that there are only 17 houses sold in 2017 with no bathroom, these 17 houses have the highest mean price and their mean is 10,000 yuan higher than the second one---houses with 1 bathroom. And the distribution is still skews right that more bathrooms indicate lower price. There is a sudden drop on the price between 1 and 2 bathrooms. There is no much difference between 3 and 4 bathrooms. Let's compare how number of bathrooms affect price within each district.

```{r}
meanBath <- data2017 %>%
  group_by(bathRoom) %>%
  summarise(meanBathPrice=mean(price))
ggplot(meanBath, aes(x=bathRoom, y=meanBathPrice))+
  geom_col(fill="lightblue")
```

The highest mean price is either in no bathroom or 1 bathroom. For ChaoYang, DongCheng, HaiDian, and ShunYi, the distribution is bimodal that there is a second peak on price of houses with more bathrooms.

```{r}
meanBathDistrict <- data2017 %>%
  group_by(bathRoom, district) %>%
  summarise(meanBathDistrictPrice=mean(price))
ggplot(meanBathDistrict, aes(x=bathRoom, y=meanBathDistrictPrice))+
  geom_col(fill="lightblue")+
  facet_wrap(~district)
```

### 3.2.24 price vs. building structure

From the distribution of price by building structure, we can see that the most expensive listings are made of a mix of materials and the least expensive listings are made of other materials.

```{r}
ggplot(data2017, aes(x = buildingStructure, y = price)) +
  geom_col(fill="lightblue") +
  labs(x = "Building Structure", y = "Price", title = "Distribution of Price by Building Structure")
```


### 3.2.25 price vs. followers





### **Work Cited**
#some online resources that I think might be helpful 
1. It mentions the price drop on beijing houses in 2017 because of some regulations
  http://www.xinhuanet.com/english/2018-01/29/c_136933533.htm



# 4 Model 
## 4.1 Split data into train and test
```{r}
set.seed(428)
index <- sample(nrow(data2017),21002,replace = FALSE)
train <- data2017[index,c(2,3,5:22)] # exclude total price 
test <- data2017[-index,c(2,3,5:22)] # exclude total price
```
I splited the data in half, into train and test data. Train data is used to train the model, while test data is used to test the accuracy of prediction from the model. 

## 4.2 Linear Model (Validation set approach)
```{r}
linear_model <- lm(price~., data = train)
summary(linear_model)
```
In this model, I randomly split data into training set and testing set, which is the validation set approach. Based on the results of linear model, all the variables are important except for five year property and the day of month being sold.

```{r}
# training MSE
pred_train_lm <- predict(linear_model, train, type="response")
mean((pred_train_lm-train$price)^2)
# testing MSE
pred_test_lm <- predict(linear_model, test, type="response")
mean((pred_test_lm-test$price)^2)
```
After putting test data into linear model, the mean squared error for both test data and train data look pretty big. Let's look at if k-fold cross validation could produce a better MSE. 


## 4.3 Linear Model (k-fold cross validation, k=10)
```{r}
library(caret)
set.seed(428) 
train.kfold <- trainControl(method = "cv", number = 10)
# Train the model
kfold_model <- train(price ~., data = data2017[,c(2,3,5:22)], method = "lm",
               trControl = train.kfold)
(kfold_model$resample$RMSE)^2
```

The above list of number shows the MSE for each fold. Comparing the MSE of k-fold cross validation with MSE of validation set approach, performing k-fold cross validation did not improve much on MSE. 


## 4.4 Backward Regression
```{r}
library(leaps)
backward <- regsubsets(price~.,data=train,method="backward")
summary(backward)
plot(backward,scale="bic", cex.names= 0.5)
```
Based on the plot and model summary, the best backward regression model includes followers, square, subway, district ChaoYang, district DongCheng, district FengTai, district HaiDian, district Xicheng (all important districts are the core districts). Lets put these important variables in linear model. 

```{r}
backward_model <- lm(price~followers+square+subway+district, data = train)
summary(backward_model)
# training MSE
pred_train_lm <- predict(linear_model, train, type="response")
mean((pred_train_lm-train$price)^2)
# testing MSE
pred_test_lm <- predict(linear_model, test, type="response")
mean((pred_test_lm-test$price)^2)
```

Since the resulting backward model MSE for both training and testing data are very close to the MSE of linear regression using all variables, we can choose to use the simpler model with followers, square, subway, and district as the predictors. 

Coefficient interpretation:
- if followers increase by 1, the average price decreases by 39.87
- if square increases by 1, the average price decreases by 58.39
- if there is a subway near the house, we would expect the price to be 5667 Yuan higher than houses without a subway.
- Being in ChaoYang, DongCheng, FengTai, HaiDian, ShiJingShan, and XiCheng increases the price with a significant amount compared to ChangPing because these are all core districts that are located in the center of Beijing.
- Being in FangShan and ShunYi significantly decreases the price compared to ChangPing because these are the rural districts. 
- Being in DaXing and TongZhou increases the price in a small amount compared to ChangPing because these two rural areas are developing, but not as developed as core districts. (A few tech companies moved to DaXing and Beijing plans to develop TongZhou as its sub-center.)
- The price in MenTouGou is not significantly different from price in ChangPing since these two are both rural districts. 




## 4.5 Random Forest
```{r}
library(randomForest)
set.seed(428)
rf_model <- randomForest(price~.,data=train,mtry=6,importance=TRUE)
varImpPlot(rf_model)
```

Since we are using MSE to evaluate the models, we will look at the plot on the left. The plot shows that district contributes most in reducing MSE in the model, with subway, construction time, square, followers, etc in decreasing order. 


```{r}
# training MSE
pred_train_rf <- predict(rf_model, train, type="response")
mean((pred_train_rf-train$price)^2)
# testing MSE
pred_test_rf <- predict(rf_model, test, type="response")
mean((pred_test_rf-test$price)^2)
```

Random Forest significantly reduced the MSE for both prediction of training and testing dataset. The MSE for testing dataset is much larger than training dataset because of overfitting effect, but it's still better than linear models. Because we have a smaller MSE, random forest is so far the best model in predicting house price per square meter, with district, subway, contruction time, square as some of the most important predictor. 
