---
title: "Stats 15 Project"
author: "Team 13: Wanyue Dong, Michelle Pang, Liaohan Wang"
date: "10/31/2022"
output: pdf_document
---

# Section 1: Introduction

Districts: 
1-DongCheng
2-FengTai
3-YiZhuang
4-DaXing
5-FangShan
6-ChangPing
7-ChaoYang
8-HaiDian 
9-ShiJingShan
10-XiCheng
11-TongZhou
12-MenTouGou
13-ShunYi


# Section 2: Data Cleaning
```{r, message=FALSE, warning=FALSE}
# loading libraries
library(lubridate)
library(dplyr)
library(VIM)
```

```{r}
# the following code is used to import dataset that includes Chinese character
data <- read.csv("new.csv", fileEncoding = "GBK", encoding = "GBK")
```


## 2.1 Cleaning Trade Time Variable
The `r tradeTime` variable is in the format of y-m-d, we wanted to look at year, month, and day separately. Therefore, we created new variables `r year`, `r month`, `r day` based on `r tradeTime`. \newline
Since the current data has 318851 rows, we decided to use part of the data where the trade time was in 2017.

```{r, message=FALSE, warning=FALSE}
data2017 <- data %>% 
  mutate(year = year(tradeTime), month = month(tradeTime), day = day(tradeTime)) %>%
  filter(year == 2017)
head(data2017)
```

## 2.2 Missing Values
```{r, message=FALSE, warning=FALSE}
table(is.na(data2017))
na_plot <- aggr(data2017, col=c('skyblue','red'), numbers=TRUE, sortVars=TRUE, 
                labels=names(data2017), cex.axis=.4, gap=3, ylab=c("Missing data","Pattern"))
```

Our data had 507 missing values. All missing values are in variables building type and community average, and mostly in building type. The above graph shows the proportion of missing values in each variable with the highest being 0.011 for buildingType. \newline
We decided to remove all missing values for two reasons. First, 507 missing values is a relatively small amount of data compared to 43217 observations we have. Second, we did not plan to use the variable buildingType, which had the most missing values. 

```{r}
data2017 <- na.omit(data2017)
```

Now we have 42710 observations.


## 2.3 Outliers

### 2.3.1 look at variable price
```{r}
hist(data2$price)
summary(data2$price)

data2 %>% 
  filter(price<1000)

# remove house with too low price
data2 <- data2[data2$id != "101101646066", ] 
```

# look at variable square
```{r}
hist(data2$square)
summary(data2$square)

data2 %>% 
  select(url,id,totalPrice, price, square, livingRoom, drawingRoom)%>%
  filter(square>700)

# remove houses more than 1000 square
data2 <- data2[data2$square < 1000, ] 
```

# take a look at kitchen
```{r}
barplot(table(data2$kitchen))
table(data2$kitchen)
data2 %>% 
  # select(url,totalPrice, price, square, livingRoom, drawingRoom)%>%
  filter(kitchen>2) 

# change house with 3 kitchens into 1
data2[data2$id=="101101258012", 14] <- 1 

# remove another house with 3 kitchens
data2 <- data2[data2$id != "101101782929", ] 

```


# take a look at kitchen
```{r}
barplot(table(data2$subway))
table(data2$subway)
data2 %>% 
  # select(url,totalPrice, price, square, livingRoom, drawingRoom)%>%
  filter(kitchen>2) 

# change house with 3 kitchens into 1
data2[data2$id=="101101258012", 14] <- 1 

# remove another house with 3 kitchens
data2 <- data2[data2$id != "101101782929", ] 

```


# look at variable square
```{r}
hist(data2$ladderRatio)
summary(data2$ladderRatio)

data2 %>% 
  select(url,id,totalPrice, price, square, livingRoom, drawingRoom, ladderRatio)%>%
  filter(ladderRatio>5)

# remove houses more than 1000 square
data2 <- data2[data2$square < 1000, ] 
```



## 2.4 Cleaning Floor Variable 

```{r}
str_detect(`Hotel name`, "(Hilton|Marriot)")
str_extract(`rooms`, ".{2}$")
```



